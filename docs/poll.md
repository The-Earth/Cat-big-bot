# Poll

投票由 [`trusted`](trusted.md) 用户创建并启动，[`voter`](voter.md) 用户可以通过按钮投票。可以设定单多选、投票期间匿名与否、投票后匿名与否以及投票期间是否显示各选项票数。

## /init_poll
限 `trusted` 用户于群组中使用。格式：
```
/init_poll -n 标题 -o !选项1 !选项2 ... -t 时长 [-ao] [-ac] [-c] [-m] [-p]
```
* `-n` 必填，后接标题文字，可以含空格，不可含 `-` 
* `-o` 必填，后接选项，每个选项以 `!` 开头，选项文字可以含空格，不可含 `!` 和 `-`，选项个数不限
* `-t` 必填，后接投票时长，格式灵活，大致来说 `2 hours 30 mins`、`1w 4d` 之类的都是可以接受的。然而所使用的解析库没有给出明确接受的范围，推测一般的简洁时间表达均可。若投票开始后显示的结束时间不正常，则说明识别失败。（详见[这份文档](https://dateparser.readthedocs.io/en/latest/#relative-dates)；实测中文不可行）
* `-ao` 可选，若添加此参数，则投票结束前不会显示各个选项的投票者（投票期间匿名），否则会显示
* `-ac` 可选，若添加此参数，则投票结束后不会显示各个选项的投票者（投票后匿名），否则会显示
* `-c` 可选，若添加此参数，则投票结束前会显示各个选项的投票人数，否则不显示。投票结束后一定会显示各选项的人数。
* `-m` 可选，若添加此参数，则投票允许多选，否则单选
* `-p 1或2或3` 可选，设定投票权限。若不设定，则默认选择 `-p 3`
  * `-p 1`：仅限 `voter`
  * `-p 2`：限 `voter` 和通过[自动确认机器人](https://github.com/The-Earth/Telegram-MediaWiki-Confirm-Bot)验证之用户投票
  * `-p 3`：任何人均可投票

机器人会回复一条消息，内含投票设置以及开启或取消该投票的按钮。此时可检查投票设置，视需要开始或取消该投票。

### 可选参数示例

投票期间和投票后均保持匿名，但投票期间会显示各个选项的票数，不允许多选：
```
-ao -ac -c
```

投票期间匿名，投票后公开选择各选项的用户。投票期间不显示票数，不允许多选：
```
-ao 
```

### 不推荐的可选参数

```
-ao -m
```
允许多选，投票期间匿名且不显示票数。由于匿名，且没有票数变化的反馈，这会导致投票者无法确切知晓自己投了什么。

```
-ac
```
投票期间不匿名，投票后匿名。意义不大，而且即使投票结束，投票链接的预览中还是会显示部分人所投的票。

## 投票开始按钮

限 `trusted` 用户于投票开始前点按，按下后将启动投票。

## 投票取消按钮

限 `trusted` 用户于投票开始前点按，按下后投票取消。

## 选项按钮

限当前群组的 `voter` 用户于群组中点按，按下后会有提示告知已经收到您的票，只要出现该提示，就不需要再次按按钮，以免计票异常。分不同情况，按下后会有不同的效果：

* 多选投票
    * 按下已投的选项时，撤销该选项的票
    * 按下未投的选项时，选中该选项
* 单选投票
    * 已投其他选项时，撤销先前的选项，选中新点按的选项
    * 未投其他选项时，选中该选项
    * 已投当前被点按的选项时，撤销该选项的票

## 投票结束按钮

限 `trusted` 用户于群组中点按。按下后提前结束投票，显示投票结果。

## 自动结束投票

机器人会在设置的投票时间结束后自动关闭投票，并发出消息以作提醒。

## 与 Telegram 内置的投票功能对比

本机器人的优势：
* 限制投票权限
* 自动结束投票
* 投票按钮无法被 forward 到其他群组引来不必要的计票困难

本机器人的劣势：
* 简陋的投票界面
* 较繁琐的指令启动方式
* 按下投票按钮后较慢的响应速度
